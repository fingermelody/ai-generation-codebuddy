# 项目名称：AI 生图生 3D Web 应用

## 1. 项目概述

### 1.1 项目背景
随着 AIGC（AI 生成内容）技术的快速发展，文生图和图生 3D 技术日趋成熟。市场上存在多种优秀的 AI 模型（如混元、豆包等），但用户往往需要在不同平台间切换使用。本项目旨在打造一个统一的 Web 应用，整合多种 AI 模型能力，提供一站式的文生图和图生 3D 创作体验。

### 1.2 项目目标
- 构建一个单页面 Web 应用，实现文生图、图生 3D 的完整工作流
- 支持多种 AI 模型（混元、豆包等）的灵活切换
- 提供流畅的单屏交互体验，降低用户学习成本
- 基于腾讯云开发（CloudBase）构建，实现快速部署和弹性扩展

### 1.3 目标用户
- **设计师/创意工作者**：需要快速生成概念图和 3D 模型原型
- **游戏/影视从业者**：需要批量生成素材资源
- **电商运营人员**：需要生成产品展示图和 3D 展示模型
- **AI 技术爱好者**：希望体验和对比不同 AI 模型的生成效果

## 2. 功能需求

### 2.1 核心功能
- **文生图模块**：通过文本描述生成 2D 图像
- **图生 3D 模块**：将 2D 图像转换为 3D 模型
- **模型切换**：支持混元、豆包等多种 AI 模型的选择与切换
- **作品管理**：历史记录查看、下载、删除
- **实时预览**：3D 模型的交互式预览（旋转、缩放）
- **付费下载**：图片和 3D 模型下载需付费，支持微信支付和支付宝

### 2.2 功能详细描述

#### 2.2.1 文生图模块
| 功能项 | 描述 |
|--------|------|
| 提示词输入 | 支持中英文提示词输入，最大 2000 字符 |
| 负向提示词 | 可选，用于排除不需要的元素 |
| 模型选择 | 下拉选择：混元图像、豆包图像等 |
| 图像参数 | 分辨率（512x512 / 1024x1024）、生成数量（1-4张） |
| 生成进度 | 实时显示生成进度条和预估时间 |
| 结果展示 | 网格展示生成的图像，支持单图放大查看 |

#### 2.2.2 图生 3D 模块
| 功能项 | 描述 |
|--------|------|
| 图像来源 | 支持从文生图结果选择，或本地上传图片 |
| 模型选择 | 下拉选择：混元 3D、豆包 3D 等 |
| 3D 参数 | 输出格式（GLB/OBJ/FBX）、精度级别 |
| 生成进度 | 实时显示转换进度 |
| 3D 预览 | Three.js 渲染的交互式 3D 预览器 |
| 模型下载 | 支持多种格式导出下载 |

#### 2.2.3 模型管理
| 功能项 | 描述 |
|--------|------|
| 模型配置 | 后台可配置可用的 AI 模型列表 |
| 模型状态 | 显示各模型的可用状态和响应延迟 |
| 模型切换 | 用户可在生成前切换不同模型 |

#### 2.2.4 作品管理
| 功能项 | 描述 |
|--------|------|
| 历史记录 | 展示用户生成的所有图像和 3D 模型 |
| 批量操作 | 支持批量下载、批量删除 |
| 搜索筛选 | 按时间、类型、模型筛选历史作品 |

#### 2.2.5 付费下载模块
| 功能项 | 描述 |
|--------|------|
| 定价策略 | 图片下载：¥1-5/张（按分辨率）；3D 模型下载：¥5-20/个（按精度） |
| 支付方式 | 微信支付（JSAPI/Native）、支付宝（网页支付） |
| 订单管理 | 订单创建、支付状态查询、订单历史 |
| 支付流程 | 点击下载 → 弹出支付选择 → 扫码/确认支付 → 支付成功 → 自动下载 |
| 支付回调 | 异步通知处理、订单状态更新、下载权限授予 |
| 退款机制 | 支持 24 小时内未下载订单申请退款 |
| 发票服务 | 支持电子发票申请（可选） |

### 2.3 用户流程

```
┌─────────────────────────────────────────────────────────────────┐
│                        单屏交互界面                              │
├─────────────┬─────────────────────────┬─────────────────────────┤
│   左侧面板   │       中央画布区         │       右侧面板          │
│             │                         │                         │
│ ┌─────────┐ │  ┌───────────────────┐  │  ┌───────────────────┐  │
│ │提示词输入│ │  │                   │  │  │    3D 预览器      │  │
│ └─────────┘ │  │   生成图像展示     │  │  │                   │  │
│ ┌─────────┐ │  │                   │  │  │  [旋转] [缩放]    │  │
│ │模型选择 │ │  └───────────────────┘  │  │                   │  │
│ └─────────┘ │                         │  └───────────────────┘  │
│ ┌─────────┐ │  ┌───────────────────┐  │  ┌───────────────────┐  │
│ │参数设置 │ │  │   [生成图像]      │  │  │   [生成3D]        │  │
│ └─────────┘ │  │   [选择图像→3D]   │  │  │   [下载模型]      │  │
│ ┌─────────┐ │  └───────────────────┘  │  └───────────────────┘  │
│ │历史记录 │ │                         │                         │
│ └─────────┘ │                         │                         │
└─────────────┴─────────────────────────┴─────────────────────────┘
```

**主要用户流程：**
1. 用户在左侧输入提示词，选择模型和参数
2. 点击"生成图像"，中央区域展示生成结果
3. 选择满意的图像，点击"生成 3D"
4. 右侧 3D 预览器展示生成的 3D 模型
5. 用户可旋转查看、调整后下载模型

**付费下载流程：**
```
┌──────────────────────────────────────────────────────────────────┐
│                        付费下载流程                               │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────┐    ┌─────────────┐    ┌─────────────┐              │
│  │点击下载  │───▶│ 弹出支付弹窗 │───▶│ 选择支付方式 │              │
│  └─────────┘    │ 显示价格    │    │ 微信/支付宝  │              │
│                 └─────────────┘    └──────┬──────┘              │
│                                           │                      │
│                 ┌─────────────────────────▼─────────────────┐    │
│                 │              支付确认                      │    │
│                 │  ┌─────────────┐    ┌─────────────┐       │    │
│                 │  │  微信支付    │    │  支付宝     │       │    │
│                 │  │  扫码/确认   │    │  扫码/跳转  │       │    │
│                 │  └──────┬──────┘    └──────┬──────┘       │    │
│                 └─────────┼──────────────────┼──────────────┘    │
│                           │                  │                   │
│                           ▼                  ▼                   │
│                 ┌─────────────────────────────────────────┐      │
│                 │           支付结果处理                   │      │
│                 │  成功 → 授予下载权限 → 自动开始下载      │      │
│                 │  失败 → 提示重试                        │      │
│                 └─────────────────────────────────────────┘      │
└──────────────────────────────────────────────────────────────────┘
```

## 3. 非功能需求

### 3.1 性能要求
| 指标 | 要求 |
|------|------|
| 页面首屏加载 | ≤ 3 秒 |
| 文生图响应 | 开始生成后 30 秒内返回结果（取决于模型） |
| 图生 3D 响应 | 开始生成后 60 秒内返回结果（取决于模型） |
| 3D 预览帧率 | ≥ 30 FPS |
| 并发用户数 | 支持 100 并发用户 |

### 3.2 安全要求
| 项目 | 要求 |
|------|------|
| 用户认证 | 支持匿名访问（有限次数）和登录认证 |
| API 安全 | 所有 AI 模型 API 调用通过后端代理，密钥不暴露前端 |
| 内容安全 | 接入内容审核，过滤违规提示词和生成内容 |
| 数据存储 | 用户作品加密存储，支持用户主动删除 |
| 支付安全 | 支付密钥服务端存储、签名验证、防重放攻击 |
| 订单安全 | 订单号唯一性校验、金额一致性校验、防篡改 |

### 3.3 可用性要求
| 项目 | 要求 |
|------|------|
| 响应式设计 | 适配桌面端（≥1280px），移动端暂不支持 |
| 浏览器兼容 | Chrome 90+、Firefox 88+、Safari 14+、Edge 90+ |
| 无障碍 | 支持键盘导航，关键操作有明确反馈 |
| 错误处理 | 友好的错误提示，支持重试机制 |

## 4. 技术规格

### 4.1 技术栈

| 层级 | 技术选型 |
|------|----------|
| 前端框架 | React 18 + TypeScript |
| UI 组件库 | TDesign React |
| 3D 渲染 | Three.js + React Three Fiber |
| 状态管理 | Zustand |
| 构建工具 | Vite |
| 后端服务 | CloudBase 云函数 (Node.js 18) |
| 数据库 | CloudBase NoSQL 数据库 |
| 文件存储 | CloudBase 云存储 |
| 部署 | CloudBase 静态网站托管 |

### 4.2 系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户浏览器                               │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │              React SPA (文生图 + 图生3D)                 │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐  │    │
│  │  │ 提示词编辑器 │  │ 图像画廊    │  │ Three.js 3D预览 │  │    │
│  │  └─────────────┘  └─────────────┘  └─────────────────┘  │    │
│  └─────────────────────────────────────────────────────────┘    │
└───────────────────────────────┬─────────────────────────────────┘
                                │ HTTPS
┌───────────────────────────────▼─────────────────────────────────┐
│                     CloudBase 云开发平台                         │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                    静态网站托管                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                      云函数层                            │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │    │
│  │  │ text2img     │  │ img2model3d  │  │ modelProxy   │   │    │
│  │  │ (文生图代理)  │  │ (图生3D代理) │  │ (模型管理)   │   │    │
│  │  └──────┬───────┘  └──────┬───────┘  └──────────────┘   │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │    │
│  │  │ createOrder  │  │ payCallback  │  │ orderQuery   │   │    │
│  │  │ (创建订单)   │  │ (支付回调)   │  │ (订单查询)   │   │    │
│  │  └──────┬───────┘  └──────┬───────┘  └──────────────┘   │    │
│  └─────────┼─────────────────┼──────────────────────────────┘    │
│  ┌─────────▼─────────────────▼──────────────────────────────┐    │
│  │              NoSQL 数据库 + 云存储                        │    │
│  │  • 用户作品记录  • 生成历史  • 图像/模型文件存储          │    │
│  │  • 订单记录  • 支付流水  • 下载权限记录                   │    │
│  └─────────────────────────────────────────────────────────┘    │
└───────────────────────────────┬─────────────────────────────────┘
                                │ API 调用
┌───────────────────────────────▼─────────────────────────────────┐
│                      第三方服务                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │  混元大模型   │  │  豆包大模型   │  │  其他模型...  │           │
│  │  (图像/3D)   │  │  (图像/3D)   │  │              │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
│  ┌──────────────┐  ┌──────────────┐                             │
│  │  微信支付     │  │  支付宝      │                             │
│  │  (JSAPI/H5)  │  │  (网页支付)  │                             │
│  └──────────────┘  └──────────────┘                             │
└─────────────────────────────────────────────────────────────────┘
```

### 4.3 第三方集成

| 服务 | 用途 | 接入方式 |
|------|------|----------|
| 腾讯混元大模型 | 文生图、图生 3D | API 调用 |
| 字节豆包大模型 | 文生图、图生 3D | API 调用 |
| CloudBase AI | AI 能力增强 | SDK 集成 |
| 腾讯云内容安全 | 内容审核 | API 调用 |
| 微信支付 | 用户付费（JSAPI/Native/H5） | API V3 |
| 支付宝 | 用户付费（网页支付） | 开放平台 SDK |

### 4.4 支付系统设计

#### 4.4.1 数据库设计

**订单表 (orders)**
| 字段 | 类型 | 说明 |
|------|------|------|
| _id | String | 订单 ID（UUID） |
| userId | String | 用户 ID |
| resourceId | String | 资源 ID（图片/3D 模型） |
| resourceType | String | 资源类型：image / model3d |
| amount | Number | 订单金额（分） |
| status | String | 状态：pending / paid / refunded / expired |
| payMethod | String | 支付方式：wechat / alipay |
| transactionId | String | 第三方支付流水号 |
| createdAt | Date | 创建时间 |
| paidAt | Date | 支付时间 |
| expiredAt | Date | 过期时间 |

**下载权限表 (download_permissions)**
| 字段 | 类型 | 说明 |
|------|------|------|
| _id | String | 权限 ID |
| userId | String | 用户 ID |
| resourceId | String | 资源 ID |
| orderId | String | 关联订单 ID |
| downloadCount | Number | 已下载次数 |
| maxDownloads | Number | 最大下载次数（默认 3） |
| expiresAt | Date | 权限过期时间 |

#### 4.4.2 支付流程时序

```
用户          前端           云函数          微信/支付宝        数据库
 │            │              │                  │               │
 │─点击下载──▶│              │                  │               │
 │            │─创建订单────▶│                  │               │
 │            │              │─保存订单────────────────────────▶│
 │            │              │─调用统一下单───▶│               │
 │            │              │◀─返回支付参数───│               │
 │            │◀─返回支付信息─│                  │               │
 │◀─展示支付──│              │                  │               │
 │            │              │                  │               │
 │─确认支付───────────────────────────────────▶│               │
 │            │              │◀─异步通知───────│               │
 │            │              │─更新订单状态─────────────────────▶│
 │            │              │─创建下载权限─────────────────────▶│
 │            │◀─通知前端────│                  │               │
 │◀─开始下载──│              │                  │               │
```

## 5. 优先级及责任矩阵

### 5.1 功能优先级

| 优先级 | 功能模块 | 说明 |
|--------|----------|------|
| P0 | 文生图核心功能 | MVP 必须 |
| P0 | 图生 3D 核心功能 | MVP 必须 |
| P0 | 3D 预览与下载 | MVP 必须 |
| P0 | 微信支付集成 | MVP 必须，核心变现能力 |
| P1 | 支付宝支付集成 | 扩展支付渠道 |
| P1 | 多模型切换 | 首版支持混元，后续扩展 |
| P1 | 历史记录管理 | 提升用户体验 |
| P1 | 订单管理 | 用户查看购买记录 |
| P2 | 用户认证 | 可先支持匿名使用 |
| P2 | 批量操作 | 后续迭代 |
| P2 | 退款功能 | 后续迭代 |

### 5.2 责任矩阵

| 模块 | Owner | 研发处理人 | 测试处理人 |
|------|-------|-----------|-----------|
| 前端 UI/交互 | 待定 | 待定 | 待定 |
| 文生图后端 | 待定 | 待定 | 待定 |
| 图生 3D 后端 | 待定 | 待定 | 待定 |
| 3D 预览组件 | 待定 | 待定 | 待定 |
| 支付系统 | 待定 | 待定 | 待定 |
| 云开发部署 | 待定 | 待定 | 待定 |

## 6. 交付与验收

### 6.1 里程碑

| 阶段 | 内容 | 交付物 |
|------|------|--------|
| M1 - 技术验证 | 核心技术可行性验证 | 技术 POC Demo |
| M2 - MVP 开发 | 文生图 + 图生 3D 基础功能 | 可用的 Web 应用 |
| M2.5 - 支付集成 | 微信支付 + 支付宝集成 | 完整付费下载功能 |
| M3 - 功能完善 | 多模型支持、历史记录、订单管理 | 功能完整版本 |
| M4 - 上线准备 | 性能优化、安全加固、支付安全测试 | 生产就绪版本 |

### 6.2 时间线

| 阶段 | 预计周期 | 备注 |
|------|----------|------|
| M1 | 1 周 | 技术调研与 POC |
| M2 | 2 周 | 核心功能开发 |
| M2.5 | 1 周 | 支付系统集成 |
| M3 | 1 周 | 功能扩展 |
| M4 | 1 周 | 优化与上线 |
| **总计** | **6 周** | |

### 6.3 验收标准

| 验收项 | 标准 |
|--------|------|
| 功能完整性 | 所有 P0、P1 功能正常运行 |
| 性能达标 | 满足 3.1 性能要求 |
| 兼容性 | 主流浏览器正常运行 |
| 安全性 | 通过安全测试，无高危漏洞 |
| 支付功能 | 微信/支付宝支付流程完整，回调正常 |
| 用户体验 | 核心流程可在 5 分钟内完成 |

## 7. 风险评估

| 风险项 | 影响程度 | 概率 | 应对策略 |
|--------|----------|------|----------|
| AI 模型 API 不稳定 | 高 | 中 | 多模型备份、降级策略、错误重试 |
| 3D 生成质量不稳定 | 中 | 高 | 提供参数调优指引、支持重新生成 |
| 模型调用成本超预期 | 中 | 中 | 设置用户配额、引入付费机制 |
| 前端 3D 渲染性能问题 | 中 | 低 | 模型简化、LOD 技术、WebGL 优化 |
| 内容安全合规风险 | 高 | 低 | 严格内容审核、敏感词过滤 |
| 第三方模型 API 变更 | 中 | 低 | 抽象适配层、及时跟进更新 |
| 支付接口审核不通过 | 高 | 中 | 提前准备资质材料、备选支付方案 |
| 支付掉单/重复支付 | 高 | 低 | 幂等性设计、订单状态机、对账机制 |
| 支付安全漏洞 | 高 | 低 | 签名验证、HTTPS、定期安全审计 |
| 退款纠纷 | 中 | 中 | 明确退款政策、保留操作日志 |

---

*文档版本：v1.1*  
*创建日期：2026-01-11*  
*最后更新：2026-01-11*  
*更新内容：新增付费下载功能（微信支付/支付宝）*
